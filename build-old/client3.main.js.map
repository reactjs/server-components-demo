{"version":3,"file":"client3.main.js","sources":["webpack:///./src/NoteEditor.client.js","webpack:///./src/NotePreview.js","webpack:///./src/TextWithMarkdown.js","webpack:///colorette (ignored)","webpack:///./terminal-highlight (ignored)","webpack:///source-map-js (ignored)","webpack:///path (ignored)","webpack:///url (ignored)","webpack:///fs (ignored)"],"sourcesContent":["/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport {useState, useTransition} from 'react';\nimport {createFromReadableStream} from 'react-server-dom-webpack';\n\nimport NotePreview from './NotePreview';\nimport {useRefresh} from './Cache.client';\nimport {useLocation} from './LocationContext.client';\n\nexport default function NoteEditor({noteId, initialTitle, initialBody}) {\n  const refresh = useRefresh();\n  const [title, setTitle] = useState(initialTitle);\n  const [body, setBody] = useState(initialBody);\n  const [location, setLocation] = useLocation();\n  const [isNavigating, startNavigating] = useTransition();\n  const [isSaving, saveNote] = useMutation({\n    endpoint: noteId !== null ? `/notes/${noteId}` : `/notes`,\n    method: noteId !== null ? 'PUT' : 'POST',\n  });\n  const [isDeleting, deleteNote] = useMutation({\n    endpoint: `/notes/${noteId}`,\n    method: 'DELETE',\n  });\n\n  async function handleSave() {\n    const payload = {title, body};\n    const requestedLocation = {\n      selectedId: noteId,\n      isEditing: false,\n      searchText: location.searchText,\n    };\n    const response = await saveNote(payload, requestedLocation);\n    navigate(response);\n  }\n\n  async function handleDelete() {\n    const payload = {};\n    const requestedLocation = {\n      selectedId: null,\n      isEditing: false,\n      searchText: location.searchText,\n    };\n    const response = await deleteNote(payload, requestedLocation);\n    navigate(response);\n  }\n\n  function navigate(response) {\n    const cacheKey = response.headers.get('X-Location');\n    const nextLocation = JSON.parse(cacheKey);\n    const seededResponse = createFromReadableStream(response.body);\n    startNavigating(() => {\n      refresh(cacheKey, seededResponse);\n      setLocation(nextLocation);\n    });\n  }\n\n  const isDraft = noteId === null;\n  return (\n    <div className=\"note-editor\">\n      <form\n        className=\"note-editor-form\"\n        autoComplete=\"off\"\n        onSubmit={(e) => e.preventDefault()}>\n        <label className=\"offscreen\" htmlFor=\"note-title-input\">\n          Enter a title for your note\n        </label>\n        <input\n          id=\"note-title-input\"\n          type=\"text\"\n          value={title}\n          onChange={(e) => {\n            setTitle(e.target.value);\n          }}\n        />\n        <label className=\"offscreen\" htmlFor=\"note-body-input\">\n          Enter the body for your note\n        </label>\n        <textarea\n          id=\"note-body-input\"\n          value={body}\n          onChange={(e) => {\n            setBody(e.target.value);\n          }}\n        />\n      </form>\n      <div className=\"note-editor-preview\">\n        <div className=\"note-editor-menu\" role=\"menubar\">\n          <button\n            className=\"note-editor-done\"\n            disabled={isSaving || isNavigating}\n            onClick={() => handleSave()}\n            role=\"menuitem\">\n            <img\n              src=\"checkmark.svg\"\n              width=\"14px\"\n              height=\"10px\"\n              alt=\"\"\n              role=\"presentation\"\n            />\n            Done\n          </button>\n          {!isDraft && (\n            <button\n              className=\"note-editor-delete\"\n              disabled={isDeleting || isNavigating}\n              onClick={() => handleDelete()}\n              role=\"menuitem\">\n              <img\n                src=\"cross.svg\"\n                width=\"10px\"\n                height=\"10px\"\n                alt=\"\"\n                role=\"presentation\"\n              />\n              Delete\n            </button>\n          )}\n        </div>\n        <div className=\"label label--preview\" role=\"status\">\n          Preview\n        </div>\n        <h1 className=\"note-title\">{title}</h1>\n        <NotePreview title={title} body={body} />\n      </div>\n    </div>\n  );\n}\n\nfunction useMutation({endpoint, method}) {\n  const [isSaving, setIsSaving] = useState(false);\n  const [didError, setDidError] = useState(false);\n  const [error, setError] = useState(null);\n  if (didError) {\n    // Let the nearest error boundary handle errors while saving.\n    throw error;\n  }\n\n  async function performMutation(payload, requestedLocation) {\n    setIsSaving(true);\n    try {\n      const response = await fetch(\n        `${endpoint}?location=${encodeURIComponent(\n          JSON.stringify(requestedLocation)\n        )}`,\n        {\n          method,\n          body: JSON.stringify(payload),\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        }\n      );\n      if (!response.ok) {\n        throw new Error(await response.text());\n      }\n      return response;\n    } catch (e) {\n      setDidError(true);\n      setError(e);\n    } finally {\n      setIsSaving(false);\n    }\n  }\n\n  return [isSaving, performMutation];\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport TextWithMarkdown from './TextWithMarkdown';\n\nexport default function NotePreview({body}) {\n  return (\n    <div className=\"note-preview\">\n      <TextWithMarkdown text={body} />\n    </div>\n  );\n}\n","/**\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n */\n\nimport marked from 'marked';\nimport sanitizeHtml from 'sanitize-html';\n\nconst allowedTags = sanitizeHtml.defaults.allowedTags.concat([\n  'img',\n  'h1',\n  'h2',\n  'h3',\n]);\nconst allowedAttributes = Object.assign(\n  {},\n  sanitizeHtml.defaults.allowedAttributes,\n  {\n    img: ['alt', 'src'],\n  }\n);\n\nexport default function TextWithMarkdown({text}) {\n  return (\n    <div\n      className=\"text-with-markdown\"\n      dangerouslySetInnerHTML={{\n        __html: sanitizeHtml(marked(text), {\n          allowedTags,\n          allowedAttributes,\n        }),\n      }}\n    />\n  );\n}\n","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */","/* (ignored) */"],"mappings":"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","sourceRoot":""}